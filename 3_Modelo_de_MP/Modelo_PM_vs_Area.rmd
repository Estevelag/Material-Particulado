---
title: "Modelos de MP por area"
output: html_notebook
---
En este notebook se harán los modelos de material particulado(MP) 2.5u y 10u por area se elige el notebook de R para hacer
el trabajo por bloques explicando la logica de cada paso. En teoria se debe aspirar a crear un codigo en donde se pueda correr
directamente con 0 intervencion.

Primero se importan las librerías necesarias para el análisis:

```{r}
library(lmtest)
library(readxl)
library(gvlma)
library(ggplot2)
library(orcutt)
library(tidyr)
library(broom)
```

Luego se importan los datos para el modelo, depurados previamente en el notebook de la carpeta "1_Arreglo_PM_DAP_estimacion_Alvarez":

```{r}
path_data<-"../data/Datos_para_modelo/Datos_MP_BiomasaEst_Altura.xlsx"
path_data2<-"../data/Datos_para_modelo/Datos_MP_BiomasaEst_Altura.csv"
```
AHora se procede a procesar la base de datos con el nuevo modelo y con el diametro y no perimetro

```{r}
model_data <- read_excel(path_data)
model_data2<- read.csv(path_data2,sep = ';')
```
AHora se procede a procesar la base de datos con el nuevo modelo y con el diametro y no perimetro
```{r}

estimatedtot<-c()
for (j in 1:length(model_data2$Diametro)){
  Bioomasaindpred<-exp(7.6109+0.0643*(model_data2$Diametro[j])/pi)
  for (i in 1:14){
    name<-paste(c("Diametro."),i, sep = "", collapse = NULL)
    if(is.null(model_data2$name[j])){}
    else{
      Bioomasaindpred<-Bioomasaindpred+exp(7.6109+0.0643*(model_data2$name[j])/pi)# This gets the diameter of the perimeter measured
      }}
estimatedtot <- c(estimatedtot, Bioomasaindpred)
}
model_data2$NEwbiomass<-estimatedtot # This new biomass is in grams

```
Se empieza con la creacion de los modelos, se define un vector con datos a eliminar por tener efectos muy fuertes sobre 
el modelo lineal. Los datos eliminados aplican para los 2 modelos. 

```{r}
to_eliminate <- c(62)
model_data3<-model_data[-to_eliminate,]

# Separattion by / and - points and comass for numbers, replace , by .

modelo_25=lm(log(Material_2.5) ~ log(Area) + Tipo_Hoja + 0, data=model_data[-to_eliminate,])#[-c(61,62,32,168,242),])
reg2<-cochrane.orcutt(modelo_25)
summary(reg2)
bptest(reg2)
#anova(tidy(reg2))
#cbind(model_data[-to_eliminate,],rbind(NA,model.frame(reg2))) #The Anova doesnt work bc some data was used to make the transformation
#anova(reg2)
gvlma(reg2)
shapiro.test(reg2$residuals)

```
```{r}
summary(modelo_25)
shapiro.test(modelo_25$residuals)
anova(modelo_25)
plot(modelo_25)
bptest(modelo_25)
#gvlma(modelo_25)
```



```{r}
modelo_10=lm(log(Material_10) ~ log(Area) + Tipo_Hoja + 0, data=model_data[-to_eliminate,])#[-c(32,61,62,168,242),])

summary(modelo_10)
anova(modelo_10)
plot(modelo_10)
#gvlma(modelo_10)
shapiro.test(modelo_10$residuals)
bptest(modelo_10)
```

